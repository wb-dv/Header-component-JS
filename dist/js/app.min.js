(()=>{"use strict";const e={burgerButtons:document.querySelectorAll(".burger"),mobileMenuCard:document.querySelector(".mobile-menu__card"),mobileMenu:document.querySelector(".mobile-menu"),closeButton:document.querySelector(".mobile-menu__close-btn"),controlMobileMenu(){this.burgerButtons.forEach((function(e){e.classList.toggle("_open")})),this.mobileMenu.classList.toggle("_open"),this.closeButton.classList.toggle("_open")}};e.mobileMenuCard.addEventListener("click",(e=>e.stopPropagation())),e.burgerButtons.forEach((function(t){t.addEventListener("click",(()=>e.controlMobileMenu()))})),e.mobileMenu.addEventListener("click",(t=>{t.target.classList.contains("_open")&&e.controlMobileMenu()}));const t={tabsBtns:document.querySelectorAll(".level-tabs__btn"),tabs:document.querySelectorAll(".level-tabs__tab"),parentTabsBtns:document.querySelector(".level-tabs__btns"),tabsClasses:["_higher","_secondary"],toggleLevelTabs(e,t){this.parentTabsBtns.classList.remove(this.tabsClasses[t]),this.parentTabsBtns.classList.add(this.tabsClasses[e]),this.tabsBtns.forEach((t=>{t.classList.contains("level-tabs__btn"+this.tabsClasses[e])?t.classList.remove("unactive"):t.classList.add("unactive")})),this.tabs.forEach((t=>{t.classList.contains("level-tabs__tab"+this.tabsClasses[e])?t.classList.add("active"):t.classList.remove("active")}))}};t.tabsBtns.forEach((e=>{e.addEventListener("click",(e=>{t.toggleLevelTabs(e.target.getAttribute("data-active"),e.target.getAttribute("data-unactive"))}))}));const s={elems:document.querySelectorAll(".loader"),waitingElems:document.querySelectorAll(".region-select__select"),open(){this.waitingElems.forEach((e=>{e.classList.add("_waiting")})),this.elems.forEach((e=>{e.classList.add("open")}))},close(){this.waitingElems.forEach((e=>{e.classList.remove("_waiting")})),this.elems.forEach((e=>{e.classList.remove("open")}))},toggle(){this.waitingElems.forEach((e=>{e.classList.toggle("_waiting")})),this.elems.forEach((e=>{e.classList.toggle("open")}))}},n={searchRegions(e,t){let s=JSON.parse(JSON.stringify(t));if(""===e)return s;let n=new RegExp("("+e+")","gi"),i=s.filter((t=>{t.notInclude=!1,t.name.toLowerCase().includes(e.toLowerCase())?t.name=t.name.replace(n,"<strong>$&</strong>"):t.notInclude=!0,Array.isArray(t.cities)&&(t.cities=t.cities.filter((t=>!!t.name.toLowerCase().includes(e.toLowerCase())&&(t.name=t.name.replace(n,"<strong>$&</strong>"),!0))),0===t.cities.length&&(t.cities=null));let s=!Array.isArray(t.cities)||null===t.cities;return!t.notInclude||!s}));return 0===i.length?null:i}},i={fields:document.querySelectorAll(".region-select__tags-field"),showed:!1,tag:({name:e,id:t,state_id:s,type:n})=>`\n        <li class="text__base region-select__tag" data-id="${t}" data-name="${e}"\n        ${null===s?"":`data-stateid="${s}"`} \n        ${null===n?"":`data-type="${n}"`}\n        >\n            ${e}\n            <button\n            class="close-btn region-select__tag-remove"\n            type="button"\n            ></button>\n        </li>`,showField(){this.fields.forEach((e=>e.classList.add("containElems"))),this.showed=!0},hideField(){this.fields.forEach((e=>e.classList.remove("containElems"))),this.showed=!1},synchronizeFields(){this.fields[1].innerHTML=this.fields[0].innerHTML},addTag(e){let t={name:e.getAttribute("data-name"),id:e.getAttribute("data-id"),state_id:e.getAttribute("data-stateid"),type:e.getAttribute("data-type")};this.fields[0].insertAdjacentHTML("beforeend",this.tag(t)),this.synchronizeFields()},removeTag(e){e.remove(),this.synchronizeFields(),this.fields[0].children.length||this.hideField()},renderTags(e){e.forEach((e=>{this.fields[0].insertAdjacentHTML("beforeend",this.tag(e))})),this.synchronizeFields()}};i.fields.forEach((e=>{e.addEventListener("click",(e=>{if(e.target.classList.contains("region-select__tag-remove")){let t=i.fields[0].querySelector(`[data-id="${e.target.parentNode.getAttribute("data-id")}"]`),s=o.selects[0].querySelector(`[data-id="${t.getAttribute("data-id")}"]`);o.addedOptionsId.delete(s.getAttribute("data-id"))&&s.classList.remove("added"),o.synchronizeSelects(),i.removeTag(t),o.toggleDisabledSaveBtn()}}))}));const a={set(e,t,s={}){(s={"max-age":1e9}).expires instanceof Date&&(s.expires=s.expires.toUTCString());let n=encodeURIComponent(e)+"="+encodeURIComponent(t);for(let e in s){n+="; "+e;let t=s[e];!0!==t&&(n+="="+t)}document.cookie=n},get(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},delete(e){this.set(e,"",{"max-age":-1})}},o={openBtns:document.querySelectorAll(".pick-region__open-btn"),saveBtns:document.querySelectorAll(".region-select__save-btn"),mobCloseBtns:document.querySelectorAll(".region-select__close-btn"),clearInputBtn:document.querySelectorAll(".region-select__clear-input"),parent:document.querySelector(".pick-region__outer"),parentMob:document.querySelector(".mob-pick-region__outer"),popup:document.querySelector(".pick-region__outer .region-select"),popupMob:document.querySelector(".mob-pick-region__outer .region-select"),selects:document.querySelectorAll(".region-select__select"),searchInputs:document.querySelectorAll(".region-select__input"),regions:null,addedOptionsId:new Set,savedOptionsId:new Set,open(){this.popup.classList.add("_open"),this.popupMob.classList.add("_open")},close(){this.popup.classList.remove("_open"),this.popupMob.classList.remove("_open")},toggle(e){e==this.parent?this.popup.classList.toggle("_open"):e==this.parentMob&&this.popupMob.classList.toggle("_open")},getRegions(e=null){let t=new XMLHttpRequest;t.open("POST","https://studika.ru/api/areas"),t.onreadystatechange=function(){2===this.readyState&&s.open(),4===this.readyState&&200===this.status&&(o.regions=JSON.parse(this.responseText),s.close(),null!==e&&e())},t.send()},option({id:e,type:t=null,regionName:s,sityName:n=null,state_id:i=null}){return`<li class="region-select__option text__base \n      ${this.addedOptionsId.has(`${e}`)?"added":""}"\n      data-id="${e}" \n      data-name="${(n||s).replace(/<|>|\/|strong/g,"")}"\n      ${null===i?"":`data-stateid="${i}"`} \n      ${null===t?"":`data-type="${t}"`}\n      >\n         ${n||s}\n         ${null===n?"":`<div class="text__descriptor">${s.replace(/<|>|\/|strong/g,"")}</div>`}\n      </li>`},renderOptions(e=o.regions){if(null===e)return this.selects[0].insertAdjacentHTML("beforeend",'<div class="region-select__not-result">Результатов нет<div>'),void this.synchronizeSelects();e.forEach((e=>{if(!e.notInclude){let t={id:e.id,type:e.type,regionName:e.name};this.selects[0].insertAdjacentHTML("beforeend",this.option(t))}Array.isArray(e.cities)&&e.cities.forEach((t=>{let s={id:t.id,state_id:t.state_id,sityName:t.name,regionName:e.name};this.selects[0].insertAdjacentHTML("beforeend",this.option(s))}))})),this.synchronizeSelects()},synchronizeSelects(){this.selects[1].innerHTML=this.selects[0].innerHTML},clearSelects(){this.selects[0].innerHTML="",this.synchronizeSelects()},displayClearBtn(e,t){""!==e?t.classList.add("searching"):t.classList.remove("searching")},clearInput(e){e.value=""},toggleDisabledSaveBtn(){this.selectIsChanged()?this.saveBtns.forEach((e=>e.removeAttribute("disabled"))):this.saveBtns.forEach((e=>e.setAttribute("disabled","")))},serialize(){let e=[];if(0===i.fields[0].children.length)return"Any regions";for(let t of i.fields[0].children)e.push({id:t.getAttribute("data-id"),name:t.getAttribute("data-name"),state_id:t.getAttribute("data-stateid"),type:t.getAttribute("data-type")});return e},sendRegions(e,t=null){"Any regions"===e?(a.delete("regions"),e={id:e}):a.set("regions",JSON.stringify(e));let s=new XMLHttpRequest;s.open("POST","/"),s.onreadystatechange=function(){4===this.readyState&&200===this.status&&null!==t&&t()},s.send(JSON.stringify(e))},openBtnTmp(e,t){if("Any regions"===e&&(e=[{name:"Любой регион"}]),t.classList.contains("mob-pick-region")){let t='<div class="mob-pick-region__text">\n                    <div class="mob-pick-region__descritpor text__descriptor">\n                      Город или регион\n                    </div>\n                    <span class="pick-region__current-region text__base">';return e.forEach((e=>{t+=`${e.name}, `})),t=t.slice(0,-2)+'</span></div><div class="pick-region__img"></div>'}let s='<div class="pick-region__img"></div><span class="text__base pick-region__current-region">';return e.forEach((e=>{s+=`${e.name}, `})),s=s.slice(0,-2)+"</span>"},updateOpenBtnsText(e){this.openBtns.forEach((t=>{t.innerHTML="",t.insertAdjacentHTML("beforeend",this.openBtnTmp(e,t))}))},selectIsChanged(){let e=new Set(this.savedOptionsId.keys());return e.size<this.addedOptionsId.size||(this.addedOptionsId.forEach((t=>{e.delete(t)})),0!==e.size)}};o.openBtns.forEach((e=>{e.addEventListener("click",(e=>{if(o.toggle(e.currentTarget.parentNode),null===o.regions){if(a.get("regions")){let e=JSON.parse(a.get("regions"));e.forEach((e=>{o.addedOptionsId.add(e.id),o.savedOptionsId.add(e.id)})),i.showField(),i.renderTags(e)}o.getRegions(o.renderOptions.bind(o))}o.toggleDisabledSaveBtn()}))})),o.saveBtns.forEach((e=>{e.addEventListener("click",(()=>{let e=o.serialize();o.savedOptionsId=new Set(o.addedOptionsId.keys()),o.sendRegions(e,o.updateOpenBtnsText(e)),o.close()}))})),o.mobCloseBtns[1].addEventListener("click",(()=>{o.close()})),document.addEventListener("click",(()=>o.close())),window.addEventListener("DOMContentLoaded",(()=>{a.get("regions")&&o.updateOpenBtnsText(JSON.parse(a.get("regions")))})),o.parent.addEventListener("click",(e=>{e.stopPropagation()})),o.parentMob.addEventListener("click",(e=>{e.stopPropagation()})),o.searchInputs.forEach((e=>{e.addEventListener("input",(e=>{o.displayClearBtn(e.currentTarget.value,e.currentTarget.parentNode);let t=n.searchRegions(e.currentTarget.value,o.regions);o.clearSelects(),o.renderOptions(t)}))})),o.clearInputBtn.forEach((e=>{e.addEventListener("click",(e=>{o.clearInput(e.currentTarget.previousElementSibling),e.currentTarget.previousElementSibling.dispatchEvent(new Event("input",{bubbles:!0}))}))})),o.selects.forEach((e=>{e.addEventListener("click",(e=>{i.showed||i.showField();let t=null;t=e.target.classList.contains("region-select__option")?e.target:e.target.parentNode;let s=o.selects[0].querySelector(`[data-id="${t.getAttribute("data-id")}"]`);if(s.classList.contains("added")){let e=i.fields[0].querySelector(`[data-id="${s.getAttribute("data-id")}"]`);i.removeTag(e)}else i.addTag(s);o.addedOptionsId.delete(s.getAttribute("data-id"))?s.classList.remove("added"):(s.classList.add("added"),o.addedOptionsId.add(s.getAttribute("data-id"))),o.synchronizeSelects(),o.toggleDisabledSaveBtn()}))}));const r={navItems:document.querySelectorAll(".nav__item"),changeActiveItem(e){this.navItems.forEach((e=>{e.classList.remove("active")})),e.classList.add("active")}};r.navItems.forEach((e=>{e.addEventListener("click",(e=>r.changeActiveItem(e.currentTarget)))})),function(e){let t=new Image;t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",t.onload=t.onerror=function(){!function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}(2==t.height)}}()})();